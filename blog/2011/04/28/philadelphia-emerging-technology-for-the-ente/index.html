
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Yehuda Katz at Philly ETE - Rails 3.1 Engines - jwinter.org</title>
  <meta name="author" content="Joe W.">

  
  <meta name="description" content="Rails 3.1 EnginesUsing an engine in Rails 3.0.x is functionally the same as copying the engine code directly into your app. There&#8217;s one giant &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://jwinter.org/blog/2011/04/28/philadelphia-emerging-technology-for-the-ente/">
  <link href="./favicon.png" rel="icon">
  <link href="./stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="./javascripts/modernizr-2.0.js"></script>
  <script src="./javascripts/ender.js"></script>
  <script src="./javascripts/octopress.js" type="text/javascript"></script>
  <link href="./atom.xml" rel="alternate" title="jwinter.org" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="./">jwinter.org</a></h1>
  
    <h2>The more you know</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="./atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:jwinter.org/blog" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="./">Blog</a></li>
  <li><a href="./blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Yehuda Katz at Philly ETE - Rails 3.1 Engines</h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-04-28T00:00:00-04:00" pubdate data-updated="true">Apr 28<span>th</span>, 2011</time>
        
      </p>
    
  </header>


<div class="entry-content"><p><span style="font-size: medium;">Rails 3.1 Engines</span></p><p>Using an engine in Rails 3.0.x is functionally the same as copying the engine code directly into your app. There&#8217;s one giant global namespace for routing and helpers. This leads to ugly name mangling (devise_engine_login_helper) and routing collistions (match &#8220;login&#8221;).&nbsp;</p><div><span style="font-size: medium;">Detour into Rack</span></div><p /><div>Rack apps take a request hash (env) and return a response of [status_code, headers, response_body].</div><p /><div>Rails 3 router is Rack middleware, Rack apps</div><p /><div>Each middleware piece considers the thing above it &#8220;the server&#8221;, the thing below it as &#8220;the app&#8221;</div><p>Rails router can route to any rack app, seamlessly route to&nbsp;</p><p>&nbsp;</p><div>* Router chooses which Rack endpoint to send each request to</div><div>** match &#8220;/posts/*path&#8221; =&gt; SinatraApp || match &#8220;/users&#8221; =&gt; &#8220;posts#index&#8221; (translates to the controller action)</div><p /><p>&nbsp;</p><p>Some stuff that I probably should have known, but didn&#8217;t</p><p>Rails 3 router just points to Rack endpoints</p><p>Translates &#8220;posts#index&#8221; to PostsController.action(:index)</p><p>PostsController.action(:index) returns a Rack app</p><p>&nbsp;</p><p><span style="font-size: medium;">Mountable Engines in Rails 3.1 (currently in Rails edge)</span></p><p>Piotr Sarnacki developed engines for 3.1 for GSOC. His blog has a bunch of posts about Rails engines,&nbsp;<a href="http://piotrsarnacki.com/2010/12/21/mountable-apps-tutorial/  ">building an engine</a>, new&nbsp;<a href="http://piotrsarnacki.com/2010/09/14/mountable-engines/">features of engines</a>, and some of the&nbsp;<a href="http://piotrsarnacki.com/2010/09/06/rsoc-status-namespacing-engines/">reasoning behind the engines changes</a>.</p><p /><p /><div><div>** API called mount ! - mount SinatraApp =&gt; &#8220;/posts&#8221;</div><div>** This has all worked since Rails 3</div><div>** Rails 3.1&nbsp;</div><div>*** Use mount</div><div>*** Engines are now Rack apps</div><div>** General rule - mount Rack app under a specific url</div><div>** Helpers!</div><div>*** helper: devise.login_path</div><div>*** helper :all</div><div>*** only include helpers in the current namespace</div><div>** Register a namespace for the namespace for the App</div><div>*** register Blog, then Blog::helpers belong to the Blog app (?)</div><div>** Migrations</div><div>*** rake railties:copy_migrations</div><div>**** Copied over to record history</div><div>**** Timestamps are updated to reflect what happened</div><div>*** migrations are a history of applied changes</div><div>** Assets</div><div>*** served through Rails server</div><div>*** Should be easy to get working without configuration</div><div>*** Works</div><div>** Rails 3.1 Sprockets</div><div>*** Compilation pipeline</div><div>*** Top level concern - template handling,&nbsp;</div><div>*** amping up cache_javascript :all</div><div>*** could be a whole new talk</div><div>** Engines can have assets</div><div>** SCSS and CoffeeScript</div><div>*** SCSS - opt-in when you want to, avoid CSS3 vendor hacks</div><div>*** CoffeeScript application.js.coffee</div><div>*** //= require(&#8216;something&#8217;)</div><div>**** That&#8217;s a sprockets directive, see sprockets site</div><div>*** CoffeeScript - point to something cool that exists</div><div>** //= require(&#8220;rails_admin/login&#8221;);</div><div>*** SCSS can @import Engine Files</div><div>@import &#8220;rails_admin/mixins.scss&#8221;;</div><div>** rails plugin new blog &#8211;mountable &lt;=== build an engine</div><div>#+BEGIN_SRC ruby</div><div>module Blog</div><div>class Engine &lt; Rails::Engine</div><div>isolate_namespace Blog # where to look for helpers</div><div>end</div><div>end</div><div>#+END_SRC</div><div>** rails g scaffold post title:string&nbsp;</div><div>*** will detect that you&#8217;re in an engine that&#8217;s inside a namespace</div><div>*** Do all the scaffoldy stuff inside of a namespace Blog::Post</div><div>** rails server #works inside of an engine</div><div>*** Runs against dummy application that has loaded the engine inside of it</div><div>** piotrsarnacki.com ALL THE DETAILS !!!</div><div>*** What should params look like (they look the same)</div><div>** Questions</div><div>*** Multiple db connection not supported by Engines</div><div>*** Take a look at Octopus (db sharding)</div><div>**** Look at adding Engine support (use this db for this namespace)</div><div>** Assets - what&#8217;s the heroku problem? Look up the heroku problem</div><div>*** rake deploy (does that exist?)</div><div>** Devise will define the API &#8211; Devise for authentication</div></div><p /><p>&nbsp;</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Joe W.</span></span>

      








  


<time datetime="2011-04-28T00:00:00-04:00" pubdate data-updated="true">Apr 28<span>th</span>, 2011</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://jwinter.org/blog/2011/04/28/philadelphia-emerging-technology-for-the-ente/" data-via="jwinter" data-counturl="http://jwinter.org/blog/2011/04/28/philadelphia-emerging-technology-for-the-ente/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="./2010/10/12/polyfills-for-backwards-compatibility/" title="Previous Post: "Polyfills" for backwards compatibility">&laquo; "Polyfills" for backwards compatibility</a>
      
      
        <a class="basic-alignment right" href="./2012/05/27/setting-up-a-new-macbook-pro-for-ruby-ror-dev/" title="Next Post: Setting up a new MacBook Pro for Ruby / RoR development">Setting up a new MacBook Pro for Ruby / RoR development &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="./2013/01/18/advice-for-personal-projects/">Advice for Personal Projects</a>
      </li>
    
      <li class="post">
        <a href="./2012/10/16/stubbing-http-apis-with-vcr/">Stubbing HTTP APIs with VCR</a>
      </li>
    
      <li class="post">
        <a href="./2012/05/27/setting-up-a-new-macbook-pro-for-ruby-ror-dev/">Setting up a new MacBook Pro for Ruby / RoR development</a>
      </li>
    
      <li class="post">
        <a href="./2011/04/28/philadelphia-emerging-technology-for-the-ente/">Yehuda Katz at Philly ETE - Rails 3.1 Engines</a>
      </li>
    
      <li class="post">
        <a href="./2010/10/12/polyfills-for-backwards-compatibility/">"Polyfills" for backwards compatibility</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/jwinter">@jwinter</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'jwinter',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="./javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("jwinter", 4, false);
    });
  </script>
  <script src="./javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/jwinter" class="twitter-follow-button" data-show-count="false">Follow @jwinter</a>
  
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Joe W. -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
